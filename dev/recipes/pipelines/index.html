
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Online machine learning in Python">
      
      
        <meta name="author" content="The Fellowship of Online Machine Learning">
      
      
        <link rel="canonical" href="https://riverml.xyz/dev/recipes/pipelines/">
      
      
        <link rel="prev" href="../model-evaluation/">
      
      
        <link rel="next" href="../feature-extraction/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.23">
    
    
      
        <title>Pipelines - River</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      <script
  defer
  src="https://eu.umami.is/script.js"
  data-website-id="b9f84709-bbc5-48b5-b43b-ef0bcc45a1f8"
></script>
    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="River" class="md-header__button md-logo" aria-label="River" data-md-component="logo">
      
  <img src="../../img/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            River
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipelines
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/online-ml/river" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    online-ml/river
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../introduction/installation/" class="md-tabs__link">
          
  
    
  
  Introduction üçº

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../reading-data/" class="md-tabs__link">
          
  
    
  
  Recipes üåÆ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/overview/" class="md-tabs__link">
          
  
    
  
  API reference üç±

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/batch-to-online/" class="md-tabs__link">
          
  
    
  
  Examples üå∂Ô∏è

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../faq/" class="md-tabs__link">
          
  
    
  
  FAQ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../releases/unreleased/" class="md-tabs__link">
          
  
    
  
  Releases

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../benchmarks/Binary%20classification/" class="md-tabs__link">
          
  
    
  
  Benchmarks

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../license/license/" class="md-tabs__link">
          
  
    
  
  License üìù

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="River" class="md-nav__button md-logo" aria-label="River" data-md-component="logo">
      
  <img src="../../img/icon.png" alt="logo">

    </a>
    River
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/online-ml/river" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    online-ml/river
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../introduction/installation/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Introduction üçº
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Recipes üåÆ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Recipes üåÆ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reading-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reading data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model-evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pipelines
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pipelines
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-during-predict" class="md-nav__link">
    <span class="md-ellipsis">
      Learning during predict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature-extraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature extraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hyperparameter-tuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hyperparameter tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mini-batching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mini-batching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../on-hoeffding-trees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Incremental decision trees in river: the Hoeffding Tree case
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../active-learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bandits-101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-armed bandits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloning-and-mutating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloning and mutating
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rolling-computations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rolling computations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../api/overview/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    API reference üç±
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../examples/batch-to-online/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Examples üå∂Ô∏è
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../faq/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../releases/unreleased/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../benchmarks/Binary%20classification/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Benchmarks
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../license/license/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    License üìù
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-during-predict" class="md-nav__link">
    <span class="md-ellipsis">
      Learning during predict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Comparison
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="pipelines">Pipelines<a class="headerlink" href="#pipelines" title="Permanent link">&para;</a></h1>
<p>Pipelines are an integral part of River. We encourage their usage and apply them in many of their examples.</p>
<p>The <a href="../../api/compose/Pipeline"><code>compose.Pipeline</code></a> contains all the logic for building and applying pipelines. A pipeline is essentially a list of estimators that are applied in sequence. The only requirement is that the first <code>n - 1</code> steps be transformers. The last step can be a regressor, a classifier, a clusterer, a transformer, etc.</p>
<p>Here is an example:</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">compose</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">feature_extraction</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">(),</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>You can also use the <code>|</code> operator, as so:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> <span class="o">|</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">()</span> <span class="o">|</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>Or, equally:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> 
<span class="n">model</span> <span class="o">|=</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">()</span>
<span class="n">model</span> <span class="o">|=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
</code></pre></div>
<p>A pipeline, as any River estimator, has a <code>_repr_html_</code> method, which can be used to visualize it in Jupyter-like notebooks:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span>
</code></pre></div>
<div><div class="river-component river-pipeline"><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">StandardScaler</pre></summary><code class="river-estimator-params">StandardScaler (
  with_std=True
)
</code></details><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">PolynomialExtender</pre></summary><code class="river-estimator-params">PolynomialExtender (
  degree=2
  interaction_only=False
  include_bias=False
  bias_name="bias"
)
</code></details><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">LinearRegression</pre></summary><code class="river-estimator-params">LinearRegression (
  optimizer=SGD (
    lr=Constant (
      learning_rate=0.01
    )
  )
  loss=Squared ()
  l2=0.
  l1=0.
  intercept_init=0.
  intercept_lr=Constant (
    learning_rate=0.01
  )
  clip_gradient=1e+12
  initializer=Zeros ()
)
</code></details></div><style scoped>
.river-estimator {
    padding: 1em;
    border-style: solid;
    background: white;
    max-width: max-content;
}

.river-pipeline {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(#000, #000) no-repeat center / 1.5px 100%;
}

.river-union {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper > .river-estimator {
    margin-top: 1em;
}

/* Vertical spacing between steps */

.river-component + .river-component {
    margin-top: 2em;
}

.river-union > .river-estimator {
    margin-top: 0;
}

.river-union > .river-component {
    margin-top: 0;
}

.river-union > .pipeline {
    margin-top: 0;
}

/* Spacing within a union of estimators */

.river-union > .river-component + .river-component {
    margin-left: 1em;
}

/* Typography */

.river-estimator-params {
    display: block;
    white-space: pre-wrap;
    font-size: 110%;
    margin-top: 1em;
}

.river-estimator > .river-estimator-params,
.river-wrapper > .river-details > river-estimator-params {
    background-color: white !important;
}

.river-wrapper > .river-details {
    margin-bottom: 1em;
}

.river-estimator-name {
    display: inline;
    margin: 0;
    font-size: 110%;
}

/* Toggle */

.river-summary {
    display: flex;
    align-items:center;
    cursor: pointer;
}

.river-summary > div {
    width: 100%;
}
</style></div>

<p><a href="../../api/compose/Pipeline"><code>compose.Pipeline</code></a> implements a <code>learn_one</code> method which in sequence calls the <code>learn_one</code> of each component and a <code>predict_one</code> (resp <code>predict_proba_one</code>) method which calls <code>transform_one</code> on the first <code>n - 1</code> steps and <code>predict_one</code> (resp <code>predict_proba_one</code>) on the last step.</p>
<p>Here is a small example to illustrate the previous point:</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">TrumpApproval</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>({&#39;ordinal_date&#39;: 736389,
  &#39;gallup&#39;: 43.843213,
  &#39;ipsos&#39;: 46.19925042857143,
  &#39;morning_consult&#39;: 48.318749,
  &#39;rasmussen&#39;: 44.104692,
  &#39;you_gov&#39;: 43.636914000000004},
 43.75505)
</code></pre></div>
<p>We can predict the target value of a new sample by calling the <code>predict_one</code> method, however, by default, <code>predict_one</code> does not update any model parameter, therefore the predictions will be 0 and the model parameters will remain the default values (0 for <code>StandardScaler</code> component):</p>
<div class="language-python highlight"><pre><span></span><code><span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">means</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>model.predict_one(x)=0.00, y=43.76
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 0.0, &#39;gallup&#39;: 0.0, &#39;ipsos&#39;: 0.0, &#39;morning_consult&#39;: 0.0, &#39;rasmussen&#39;: 0.0, &#39;you_gov&#39;: 0.0})
model.predict_one(x)=0.00, y=43.71
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 0.0, &#39;gallup&#39;: 0.0, &#39;ipsos&#39;: 0.0, &#39;morning_consult&#39;: 0.0, &#39;rasmussen&#39;: 0.0, &#39;you_gov&#39;: 0.0})
</code></pre></div>
<p><code>learn_one</code> updates pipeline stateful steps, parameters and the prediction change:</p>
<div class="language-python highlight"><pre><span></span><code><span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">means</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>model.predict_one(x)=0.88, y=43.76
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 736389.0, &#39;gallup&#39;: 43.843213, &#39;ipsos&#39;: 46.19925042857143, &#39;morning_consult&#39;: 48.318749, &#39;rasmussen&#39;: 44.104692, &#39;you_gov&#39;: 43.636914000000004})
model.predict_one(x)=9.44, y=43.71
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 736389.5, &#39;gallup&#39;: 43.843213, &#39;ipsos&#39;: 46.19925042857143, &#39;morning_consult&#39;: 48.318749, &#39;rasmussen&#39;: 45.104692, &#39;you_gov&#39;: 42.636914000000004})
</code></pre></div>
<p>Each component of the pipeline has been updated with the new data point. </p>
<p>A pipeline is a very powerful tool that can be used to chain together multiple steps in a machine learning workflow.</p>
<p>Notice that it is also possible to call <code>transform_one</code> with a pipeline, this method will run <code>transform_one</code> of each transformer in it, and return the result of the last transformer (which is thus the penultimate step if the last step is a <em>predictor</em> or <em>clusterer</em>, while it is the last step if the last step is a <em>transformer</em>):</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>{&#39;ordinal_date&#39;: 1.0,
 &#39;gallup&#39;: 0.0,
 &#39;ipsos&#39;: 0.0,
 &#39;morning_consult&#39;: 0.0,
 &#39;rasmussen&#39;: 1.0,
 &#39;you_gov&#39;: -1.0,
 &#39;ordinal_date*ordinal_date&#39;: 1.0,
 &#39;gallup*ordinal_date&#39;: 0.0,
 &#39;ipsos*ordinal_date&#39;: 0.0,
 &#39;morning_consult*ordinal_date&#39;: 0.0,
 &#39;ordinal_date*rasmussen&#39;: 1.0,
 &#39;ordinal_date*you_gov&#39;: -1.0,
 &#39;gallup*gallup&#39;: 0.0,
 &#39;gallup*ipsos&#39;: 0.0,
 &#39;gallup*morning_consult&#39;: 0.0,
 &#39;gallup*rasmussen&#39;: 0.0,
 &#39;gallup*you_gov&#39;: -0.0,
 &#39;ipsos*ipsos&#39;: 0.0,
 &#39;ipsos*morning_consult&#39;: 0.0,
 &#39;ipsos*rasmussen&#39;: 0.0,
 &#39;ipsos*you_gov&#39;: -0.0,
 &#39;morning_consult*morning_consult&#39;: 0.0,
 &#39;morning_consult*rasmussen&#39;: 0.0,
 &#39;morning_consult*you_gov&#39;: -0.0,
 &#39;rasmussen*rasmussen&#39;: 1.0,
 &#39;rasmussen*you_gov&#39;: -1.0,
 &#39;you_gov*you_gov&#39;: 1.0}
</code></pre></div>
<p>In many cases, you might want to connect a step to multiple steps. For instance, you might to extract different kinds of features from a single input. An elegant way to do this is to use a <a href="../../api/compose/TransformerUnion"><code>compose.TransformerUnion</code></a>. Essentially, the latter is a list of transformers who's results will be merged into a single <code>dict</code> when <code>transform_one</code> is called.</p>
<p>As an example let's say that we want to apply a <a href="../../api/feature-extraction/RBFSampler"><code>feature_extraction.RBFSampler</code></a> as well as the <a href="../../api/feature-extraction/PolynomialExtender"><code>feature_extraction.PolynomialExtender</code></a>. This may be done as so:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">()</span> <span class="o">+</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">RBFSampler</span><span class="p">())</span> <span class="o">|</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">model</span>
</code></pre></div>
<div><div class="river-component river-pipeline"><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">StandardScaler</pre></summary><code class="river-estimator-params">StandardScaler (
  with_std=True
)
</code></details><div class="river-component river-union"><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">PolynomialExtender</pre></summary><code class="river-estimator-params">PolynomialExtender (
  degree=2
  interaction_only=False
  include_bias=False
  bias_name="bias"
)
</code></details><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">RBFSampler</pre></summary><code class="river-estimator-params">RBFSampler (
  gamma=1.
  n_components=100
  seed=None
)
</code></details></div><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">LinearRegression</pre></summary><code class="river-estimator-params">LinearRegression (
  optimizer=SGD (
    lr=Constant (
      learning_rate=0.01
    )
  )
  loss=Squared ()
  l2=0.
  l1=0.
  intercept_init=0.
  intercept_lr=Constant (
    learning_rate=0.01
  )
  clip_gradient=1e+12
  initializer=Zeros ()
)
</code></details></div><style scoped>
.river-estimator {
    padding: 1em;
    border-style: solid;
    background: white;
    max-width: max-content;
}

.river-pipeline {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(#000, #000) no-repeat center / 1.5px 100%;
}

.river-union {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper > .river-estimator {
    margin-top: 1em;
}

/* Vertical spacing between steps */

.river-component + .river-component {
    margin-top: 2em;
}

.river-union > .river-estimator {
    margin-top: 0;
}

.river-union > .river-component {
    margin-top: 0;
}

.river-union > .pipeline {
    margin-top: 0;
}

/* Spacing within a union of estimators */

.river-union > .river-component + .river-component {
    margin-left: 1em;
}

/* Typography */

.river-estimator-params {
    display: block;
    white-space: pre-wrap;
    font-size: 110%;
    margin-top: 1em;
}

.river-estimator > .river-estimator-params,
.river-wrapper > .river-details > river-estimator-params {
    background-color: white !important;
}

.river-wrapper > .river-details {
    margin-bottom: 1em;
}

.river-estimator-name {
    display: inline;
    margin: 0;
    font-size: 110%;
}

/* Toggle */

.river-summary {
    display: flex;
    align-items:center;
    cursor: pointer;
}

.river-summary > div {
    width: 100%;
}
</style></div>

<p>Note that the <code>+</code> symbol acts as a shorthand notation for creating a <a href="../../api/compose/TransformerUnion"><code>compose.TransformerUnion</code></a>, which means that we could have declared the above pipeline as so:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> <span class="o">|</span>
    <span class="n">compose</span><span class="o">.</span><span class="n">TransformerUnion</span><span class="p">(</span>
        <span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">(),</span>
        <span class="n">feature_extraction</span><span class="o">.</span><span class="n">RBFSampler</span><span class="p">()</span>
    <span class="p">)</span> <span class="o">|</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>Pipelines provide the benefit of removing a lot of cruft by taking care of tedious details for you. They also enable to clearly define what steps your model is made of.</p>
<p>Finally, having your model in a single object means that you can move it around more easily.</p>
<p>Note that you can include user-defined functions in a pipeline by using a <a href="../../api/compose/FuncTransformer"><code>compose.FuncTransformer</code></a>.</p>
<h2 id="learning-during-predict">Learning during predict<a class="headerlink" href="#learning-during-predict" title="Permanent link">&para;</a></h2>
<p>In online machine learning, we can update the unsupervised parts of our model when a sample arrives. We don't <em>really</em> have to wait for the ground truth to arrive in order to update unsupervised estimators that don't depend on it.</p>
<p>In other words, in a pipeline, <code>learn_one</code> updates the supervised parts, whilst <code>predict_one</code> (or <code>predict_proba_one</code> for that matter) <strong>can</strong> update the unsupervised parts, which often yields better results. </p>
<p>In river, we can achieve this behavior using a dedicated context manager: <a href="../../api/compose/learn-during-predict"><code>compose.learn_during_predict</code></a>.</p>
<p>Here is the same example as before, with the only difference of activating the such learning during predict behavior:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> <span class="o">|</span>
    <span class="n">feature_extraction</span><span class="o">.</span><span class="n">PolynomialExtender</span><span class="p">()</span> <span class="o">|</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="k">with</span> <span class="n">compose</span><span class="o">.</span><span class="n">learn_during_predict</span><span class="p">():</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;StandardScaler&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">means</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>model.predict_one(x)=0.00, y=43.76
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 736389.0, &#39;gallup&#39;: 43.843213, &#39;ipsos&#39;: 46.19925042857143, &#39;morning_consult&#39;: 48.318749, &#39;rasmussen&#39;: 44.104692, &#39;you_gov&#39;: 43.636914000000004})
model.predict_one(x)=0.00, y=43.71
model[&#39;StandardScaler&#39;].means = defaultdict(&lt;class &#39;float&#39;&gt;, {&#39;ordinal_date&#39;: 736389.5, &#39;gallup&#39;: 43.843213, &#39;ipsos&#39;: 46.19925042857143, &#39;morning_consult&#39;: 48.318749, &#39;rasmussen&#39;: 45.104692, &#39;you_gov&#39;: 42.636914000000004})
</code></pre></div>
<p>Calling <code>predict_one</code> within this context will update each transformer of the pipeline. For instance here we can see that the mean of each feature of the standard scaler step have been updated.</p>
<p>On the other hand, the supervised part of our pipeline, the linear regression, has not been updated or learned anything yet. Hence the prediction on any sample will be nil because each weight is still equal to 0.</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;LinearRegression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">weights</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>(0.0, {})
</code></pre></div>
<h2 id="performance-comparison">Performance Comparison<a class="headerlink" href="#performance-comparison" title="Permanent link">&para;</a></h2>
<p>One may wonder what is the advantage of learning during predict. Let's compare the performance of a pipeline with and without learning during predict, in two scenarios: one in which the flow of data stays the same, we just update </p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">nullcontext</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">score_pipeline</span><span class="p">(</span><span class="n">learn_during_predict</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">n_learning_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scores a pipeline on the TrumpApproval dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    learn_during_predict : bool</span>
<span class="sd">        Whether or not to learn the unsupervided components during the prediction step.</span>
<span class="sd">        If False it will only learn when `learn_one` is explicitly called.</span>
<span class="sd">    n_learning_samples : int | None </span>
<span class="sd">        Number of samples used to `learn_one`.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    MAE : float</span>
<span class="sd">        Mean absolute error of the pipeline on the dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">TrumpApproval</span><span class="p">()</span>

    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span> <span class="o">|</span>
        <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">()</span>

    <span class="n">ctx</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">learn_during_predict</span> <span class="k">if</span> <span class="n">learn_during_predict</span> <span class="k">else</span> <span class="n">nullcontext</span>
    <span class="n">n_learning_samples</span> <span class="o">=</span> <span class="n">n_learning_samples</span> <span class="ow">or</span> <span class="n">dataset</span><span class="o">.</span><span class="n">n_samples</span>

    <span class="k">with</span> <span class="n">ctx</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_idx</span> <span class="o">&lt;</span> <span class="n">n_learning_samples</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="n">max_samples</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">TrumpApproval</span><span class="p">()</span><span class="o">.</span><span class="n">n_samples</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;learn_during_predict&quot;</span><span class="p">:</span> <span class="n">learn_during_predict</span><span class="p">,</span>
        <span class="s2">&quot;pct_learning_samples&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">n_learning_samples</span><span class="o">/</span><span class="n">max_samples</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="n">score_pipeline</span><span class="p">(</span><span class="n">learn_during_predict</span><span class="o">=</span><span class="n">learn_during_predict</span><span class="p">,</span> <span class="n">n_learning_samples</span><span class="o">=</span><span class="n">n_learning_samples</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">learn_during_predict</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n_learning_samples</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_samples</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">//</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">max_samples</span><span class="o">//</span><span class="mi">10</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
 <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;learn_during_predict&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;pct_learning_samples&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<style type="text/css">
</style>
<table id="T_059da">
  <thead>
    <tr>
      <th class="index_name level0" >learn_during_predict</th>
      <th id="T_059da_level0_col0" class="col_heading level0 col0" >False</th>
      <th id="T_059da_level0_col1" class="col_heading level0 col1" >True</th>
    </tr>
    <tr>
      <th class="index_name level0" >pct_learning_samples</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_059da_level0_row0" class="row_heading level0 row0" >100.0%</th>
      <td id="T_059da_row0_col0" class="data row0 col0" >1.314548</td>
      <td id="T_059da_row0_col1" class="data row0 col1" >1.347434</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row1" class="row_heading level0 row1" >90.0%</th>
      <td id="T_059da_row1_col0" class="data row1 col0" >1.629333</td>
      <td id="T_059da_row1_col1" class="data row1 col1" >1.355274</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row2" class="row_heading level0 row2" >80.0%</th>
      <td id="T_059da_row2_col0" class="data row2 col0" >2.712125</td>
      <td id="T_059da_row2_col1" class="data row2 col1" >1.371599</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row3" class="row_heading level0 row3" >70.0%</th>
      <td id="T_059da_row3_col0" class="data row3 col0" >4.840620</td>
      <td id="T_059da_row3_col1" class="data row3 col1" >1.440773</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row4" class="row_heading level0 row4" >60.0%</th>
      <td id="T_059da_row4_col0" class="data row4 col0" >8.918634</td>
      <td id="T_059da_row4_col1" class="data row4 col1" >1.498240</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row5" class="row_heading level0 row5" >50.0%</th>
      <td id="T_059da_row5_col0" class="data row5 col0" >15.112753</td>
      <td id="T_059da_row5_col1" class="data row5 col1" >1.878434</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row6" class="row_heading level0 row6" >40.0%</th>
      <td id="T_059da_row6_col0" class="data row6 col0" >26.387331</td>
      <td id="T_059da_row6_col1" class="data row6 col1" >2.105553</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row7" class="row_heading level0 row7" >30.0%</th>
      <td id="T_059da_row7_col0" class="data row7 col0" >42.997083</td>
      <td id="T_059da_row7_col1" class="data row7 col1" >3.654709</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row8" class="row_heading level0 row8" >20.0%</th>
      <td id="T_059da_row8_col0" class="data row8 col0" >90.703102</td>
      <td id="T_059da_row8_col1" class="data row8 col1" >3.504950</td>
    </tr>
    <tr>
      <th id="T_059da_level0_row9" class="row_heading level0 row9" >10.0%</th>
      <td id="T_059da_row9_col0" class="data row9 col0" >226.836953</td>
      <td id="T_059da_row9_col1" class="data row9 col1" >4.803600</td>
    </tr>
  </tbody>
</table>

<p>As we can see from the resulting table above, the scores are comparable only in the case in which the percentage of learning samples above 90%. After that the score starts to degrade quite fast as the percentage of learning samples decreases, and it is very remarkable (one order of magnitude or more) when less than 50% of the samples are used for learning.</p>
<p>Although a simple case, this examplify how powerful it can be to learn unsupervised components during predict.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 - 2023
          </div>
        
        Made with
        <a
          href="https://squidfunk.github.io/mkdocs-material/"
          target="_blank" rel="noopener"
        >
          Material for MkDocs
        </a>
      </div>

      <!-- Social links -->
      <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/online-ml/river" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.instant", "navigation.indexes", "navigation.prune"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ebd0bdb7.min.js"></script>
      
        <script src="../../js/mkdocs-charts-plugin.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
    
  </body>
</html>